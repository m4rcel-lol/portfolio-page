// ============================================
// THEME MANAGEMENT
// ============================================

class ThemeManager {
    constructor() {
        this.themeToggle = document.querySelector('.theme-toggle');
        this.prefersDark = window.matchMedia('(prefers-color-scheme:  dark)');
        this.init();
    }
    
    init() {
        this.loadTheme();
        this.themeToggle.addEventListener('click', () => this.toggleTheme());
        this.prefersDark. addEventListener('change', () => this.updateTheme());
    }
    
    loadTheme() {
        const savedTheme = localStorage. getItem('theme');
        if (savedTheme) {
            document.body.classList.toggle('dark-mode', savedTheme === 'dark');
        } else {
            document.body. classList.toggle('dark-mode', this.prefersDark.matches);
        }
    }
    
    toggleTheme() {
        document.body.classList.toggle('dark-mode');
        const isDark = document.body.classList. contains('dark-mode');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
    }
    
    updateTheme() {
        if (! localStorage.getItem('theme')) {
            this.loadTheme();
        }
    }
}

// ============================================
// PROJECTS LOADER
// ============================================

class ProjectsLoader {
    constructor() {
        this.projectsGrid = document.getElementById('projectsGrid');
        this.projects = [
            {
                title: 'Portfolio Page',
                description: 'A modern, production-ready portfolio website built with HTML, CSS, and JavaScript.  Features responsive design, dark mode support, and smooth animations.',
                icon: 'ðŸŽ¨',
                tech: ['HTML', 'CSS', 'JavaScript'],
                stars: 'Latest',
                link: 'https://github.com/m4rcel-lol/portfolio-page'
            },
            {
                title: 'Open Source Contributions',
                description: 'Active contributor to various open source projects.  Passionate about improving code quality and community-driven development.',
                icon: 'ðŸš€',
                tech: ['Git', 'GitHub', 'Collaboration'],
                stars: 'Active',
                link: 'https://github.com/m4rcel-lol'
            },
            {
                title: 'Web Applications',
                description: 'Building full-stack web applications with modern frameworks and tools. Focus on scalability, performance, and user experience.',
                icon: 'ðŸ’»',
                tech: ['JavaScript', 'React', 'Node.js'],
                stars: 'Featured',
                link: 'https://github.com/m4rcel-lol? tab=repositories'
            },
            {
                title: 'Developer Tools',
                description: 'Creating developer tools and utilities to improve productivity and streamline development workflows.',
                icon: 'ðŸ› ï¸',
                tech: ['Tooling', 'CLI', 'Automation'],
                stars: 'Useful',
                link: 'https://github.com/m4rcel-lol'
            },
            {
                title: 'Learning Projects',
                description: 'Exploring new technologies and frameworks through practical projects. Always learning and staying updated with industry trends.',
                icon: 'ðŸ“š',
                tech: ['Experimentation', 'Growth', 'Learning'],
                stars: 'Growth',
                link: 'https://github.com/m4rcel-lol'
            },
            {
                title: 'Community',
                description: 'Engaging with the developer community through contributions, discussions, and knowledge sharing.',
                icon: 'ðŸ‘¥',
                tech: ['Community', 'Mentoring', 'Sharing'],
                stars: 'Engaged',
                link: 'https://github.com/m4rcel-lol'
            }
        ];
        this. init();
    }
    
    init() {
        this.renderProjects();
    }
    
    renderProjects() {
        this.projectsGrid.innerHTML = this.projects. map(project => `
            <div class="project-card">
                <div class="project-header">
                    <div class="project-icon">${project.icon}</div>
                    <span class="project-star">${project.stars}</span>
                </div>
                <h3 class="project-title">${project.title}</h3>
                <p class="project-description">${project.description}</p>
                <div class="project-tech">
                    ${project.tech.map(tech => `<span class="tech-tag">${tech}</span>`).join('')}
                </div>
                <a href="${project.link}" target="_blank" rel="noopener noreferrer" class="project-link">
                    View Project â†’
                </a>
            </div>
        `).join('');
    }
}

// ============================================
// SMOOTH SCROLL & ACTIVE NAVIGATION
// ============================================

class NavigationManager {
    constructor() {
        this.navLinks = document.querySelectorAll('.nav-link');
        this.sections = document.querySelectorAll('section[id]');
        this.init();
    }
    
    init() {
        this.navLinks.forEach(link => {
            link.addEventListener('click', (e) => this.handleNavClick(e));
        });
        
        window.addEventListener('scroll', () => this.updateActiveLink());
    }
    
    handleNavClick(e) {
        e.preventDefault();
        const targetId = e.target.getAttribute('href').substring(1);
        const targetSection = document.getElementById(targetId);
        
        if (targetSection) {
            targetSection.scrollIntoView({ behavior: 'smooth' });
        }
    }
    
    updateActiveLink() {
        let current = '';
        
        this.sections.forEach(section => {
            const sectionTop = section.offsetTop;
            const sectionHeight = section. clientHeight;
            
            if (pageYOffset >= sectionTop - 200) {
                current = section.getAttribute('id');
            }
        });
        
        this.navLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === `#${current}`) {
                link.classList.add('active');
            }
        });
    }
}

// ============================================
// SCROLL ANIMATIONS
// ============================================

class ScrollAnimations {
    constructor() {
        this.observerOptions = {
            threshold:  0.1,
            rootMargin: '0px 0px -100px 0px'
        };
        this.init();
    }
    
    init() {
        if ('IntersectionObserver' in window) {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry. target.style.opacity = '1';
                        entry.target. style.transform = 'translateY(0)';
                    }
                });
            }, this. observerOptions);
            
            document.querySelectorAll('.project-card, .skill-card, .stat').forEach(element => {
                element.style.opacity = '0';
                element.style.transform = 'translateY(20px)';
                element.style.transition = 'opacity 0.6s ease-out, transform 0.6s ease-out';
                observer.observe(element);
            });
        }
    }
}

// ============================================
// PERFORMANCE & ACCESSIBILITY
// ============================================

class PerformanceOptimizer {
    static init() {
        // Lazy load images
        if ('IntersectionObserver' in window) {
            const imageObserver = new IntersectionObserver((entries, observer) => {
                entries. forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        if (img.dataset.src) {
                            img.src = img.dataset.src;
                            observer.unobserve(img);
                        }
                    }
                });
            });
            
            document.querySelectorAll('img[data-src]').forEach(img => {
                imageObserver.observe(img);
            });
        }
        
        // Add loading attribute to images
        document.querySelectorAll('img').forEach(img => {
            img.loading = 'lazy';
        });
    }
}

// ============================================
// ANALYTICS & TRACKING
// ============================================

class Analytics {
    static trackEvent(category, action, label) {
        if (window.gtag) {
            gtag('event', action, {
                'event_category': category,
                'event_label': label
            });
        }
    }
    
    static init() {
        // Track link clicks
        document.querySelectorAll('a[target="_blank"]').forEach(link => {
            link.addEventListener('click', () => {
                Analytics.trackEvent('external', 'click', link.href);
            });
        });
        
        // Track section views
        document.querySelectorAll('section[id]').forEach(section => {
            const observer = new IntersectionObserver((entries) => {
                entries. forEach(entry => {
                    if (entry.isIntersecting) {
                        Analytics.trackEvent('section', 'view', entry.target.id);
                    }
                });
            });
            observer.observe(section);
        });
    }
}

// ============================================
// INITIALIZATION
// ============================================

document. addEventListener('DOMContentLoaded', () => {
    // Initialize all components
    new ThemeManager();
    new ProjectsLoader();
    new NavigationManager();
    new ScrollAnimations();
    PerformanceOptimizer.init();
    Analytics.init();
    
    console.log('âœ¨ Portfolio loaded successfully!');
});

// ============================================
// SERVICE WORKER REGISTRATION (PWA)
// ============================================

if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator. serviceWorker.register('sw.js').catch(err => {
            console.log('ServiceWorker registration failed:  ', err);
        });
    });
}